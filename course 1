EVENT LOOP - 50
SHOURTCUTS - 75
WHEN WE WRITE CODE - 82
VSCode SETUP -150
MIDDLEWARE -240
SERVING STATIC FILES FROM A FOLDER (and not from a ROUTE) (CSS FILE, IMAGES etc. / FILE/FOLDER IMPORT) - 330
ROUTING - 430
STATUSCODES - 600
TYPES OF ERRORS - 620
SERVER SIDE RENDERING with TEMPLATING ENGINES (EJS) -> FOR  DYNAMIC  OR REALTIME CONTENT/FEATURES IN THE FRONTEND - 666
MVC (ARCHITECTURE) / DESIGN PATTERN - 740
PASSWORD ENCRYPTION/HASHING - 760



ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED
***********************************************************************************************************************************************
ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED ADCANCED

SENDING E-MAIL <how to> - 744
HOW TO SETUP COOKIES  - 755
SESSIONS - 764
WEBSOCKETS (API) - 802 
OAUTH - 860
DOTENV - 880
AUTHENTICATION -


***************




NODE.JS ROADMAP                                                                                                                                    START 20.10.22
_______________

https://roadmap.sh/nodejs

- Express is a minimal (http) Framework for (running) Node.js (servers) build on TOP of node
- is an Backend Framework
- for Server Side Applications
- is an API
- JS RUNTIME -> allows to run javascript on a server (= outside of a browser)
- package.json => the file includes all the packages which have installed in node (= dependencies)
- node is using just one single thread (if there are 10 users or 1000000 -> its still a single thread)


- node is build around (using) MODULES and CALLBACKS (functions)!
- in node, every file is treated as a MODULE ->

          THAT MEANS (if we wanna export and import our own module for example):

app.js
const replaceTemplate = require('./modules/replaceTemplates');

Modules Folder (on root folder)

xxx.js (in the Modules folder)
module.exports = (xxx, xxx) => { // thats a anynomous function which we export from here with the modules object
...
};


- everything whats not related to express has to be outside of app.js file




          EVENT LOOP
          __________

lecture 32

"The heart of the node architecture"

All the app code that is inside the CALLBACK FUNCTIONS (non-top-level-code)



NOTE:
using callbacks doesn't make it automaticly asynchronous!


?!?!?!?!??!

localhost:  makes my own ip adress behave like a remote web server

('/')  Thats the Starting Page (the root)
... JavaScript object spread operator                                   https://www.javascripttutorial.net/es-next/javascript-object-spread/

Events, Event Loop:




          SHOURTCUTS
          __________

open dev tools on chrome: Option + âŒ˜ + J 




          WHEN WE WRITE CODE
          __________________

1. Safe File                                                                                 SAVE
2. Start Server (in Terminal -> node (filename) app.js                                       EXECUTE
-> SETUP A PORT
3. (Web-)Site starting     zb. mit google chrome -> dort in die URL -> localhost:3000/test   RUN




          USING/REQUIERING MODULES
          ________________________

- npm packages are also called MODULE(S)

          
require KEYWORD -> to import files 
                -> or npm packages


const fs = require("fs"); // = filesystem package core module

random -> for creating the message.txt file
fs.writeFileSync("message.txt", "DUMMY");


BEST CASE ORDER of using MODULES:

1. that are the 'CORE' MODULES
const fs = require("fs");
const http = require("http");
const url = require("url");

2. requirering 3 party modules
const slugify = require('slugify');

3. OWN IMPORTED MODULES
const replaceTemplate = require('./modules/replaceTemplates');


NOTE:

never share the nodes modules folder (there is no need for) -its way to big, or upload it on github!




          SYNCHRONOUS VS. ASYNCHRONOUS CODE
          _________________________________

          SYNCHRONOUS         ASYNCHRONOUS
Â               â¬‡ï¸                  â¬‡ï¸
          BLOCKING CODE ðŸ‘Ž    NON-BLOCKING CODE ðŸ‘


                    CALLBACK FUNCTIONS !!?!?



  
          VSCode SETUP
          ____________

npm node package manager -> comes automatically with node

1. (run in terminal) npm init -> to get the package.json (file) => file includes all the packages (dependencies) which are installed in node

2. npm install --save express   -> (express is the node framwork) its creating the node modules folder -> express is all about middlewares

3. npm install nodemon --save-dev

replace the file content with that, in the package json file -> 

{
  "name": "complete-node.js-course",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "nodemon app.js"     // this line will execute/safe the app automaticly after making changes
  },
  "author": "",
  "license": "ISC"
}                            


3.2 Terminal Command: 

   npm start -> nodemon is now running



4. OPTIONAL

   If we want use ROUTES
   npm install --save body-parser    // we just need a body parser if our website should handle http POST request data
                                     // for parsing incoming request bodys




          CREATING A NEW SERVER
          _____________________

const http = require("http");
const express = require("express");
const app = express();

const server = http.createServer(app);

server.listen(3000);

_____________________________ _/ _/ _/



const http = require('http');

const server = http.createServer((req, res) => {       // create server callback function
    console.log(req);
});

server.listen(3000);                                   // looping process (Event Loop)  -> keep on listening for requests

// *** THATS ALL WE NEED TO CREATE A NEW SERVER ***




          MIDDLEWARE
          __________

middleware is a function, that can modify the incoming REQUEST data

It's called middleware because it stands between. 
'In the MIDDLE of the request and the response.'


SYNTAX:

app.use();  // .use allows us to add a middleware function

app.use((req, res, next) => {
....
};   



app.use((req, res, next) => {             // next just if we use multiple middlewares
  console.log("In the middleware");
  next(); // next allows us to travel to the next middleware
});

app.use((req, res, next) => {  
  console.log("Another middleware");
  next();
});

app.use((req, res) => {
  console.log("Last middleware");
  res.send("<h1>Hello</h1>");           // res.send to finally send a response
});


lecture 58
(incoming) REQ -> MIDDLEWARE STACK -> RES
-> this  calls the "Response Request Cycle"


!!!
The "Route-Handler" has to be AFTER the middleware (function) otherwise the middleware will not be called!
Because the "Response Request Cycle" has already be finished.

- The Order really matters in express



PARAM MIDDLEWARE
________________

param stands for parameter
                                     4. ARGUMENT
                                     â¬‡ï¸
router.param('id', (req, res, next, val) => { // val will hold the id parameter
  console.log(`Tour id is: ${val}`);
  next();
});



writing-error-handlers
______________________

AKA  SETUP CUSTOM ERROR HANDLER IN EXPRESS

https://expressjs.com/en/guide/error-handling.html#writing-error-handlers


MIDDLEWARE FOULDER:
error-handler.js:

const errorHandlerMiddleware = function (err, req, res, next) {
  // return res.status(500).json({ msg: err }); // own preferences
  return res.status(500).json({ msg: `Something went wrong` });
};

module.exports = errorHandlerMiddleware;



app.js:

const errorHandlerMiddleware = require("./middleware/error-handler");

// routes
app.use(errorHandlerMiddleware)




          SERVING STATIC FILES FROM A FOLDER (and not from a ROUTE)
          (CSS FILE, IMAGES etc. FILE/FOLDER IMPORT)
          _________________________________________________________

app.js:

app.use(express.static(`${__dirname}/public`)); // JONAS
app.use(express.static(path.join(__dirname, 'folder'))); // makes it like if we are already in this folder ->  DOESNT WORK 

app.use("/images", express.static("images")); _/ _/ _/ WORKS BEST SO FAR !!!



html file:

    <link rel="stylesheet" href="/folder/file" />




          REQUESTS
          ________

https://www.twilio.com/blog/2017/08/http-requests-in-node-js.html
      
      
  const https = require('https');
    

req  means request  (Client)Frontend is sending a request to the (Server) Backend

- requests will be included in html and css and ... (Frontend)files

EXAMPLE....


Type: (of requests)     http verbs

use       for handle any method
get       get request to a certain url                                  get a resource from the server
post      intend is to modify(change) data  or  create something        post a resource to the server
patch     intend is to modify(change) data                              update parts off an existing resource on the server
put
delete    delete a resource on the server


      271
get 
post


SUBMIT BUTTON -> is trigering a POST request (by default???)




          ASYNC AWAIT REQUESTS     OPTIONAL -> then and catch is doing the same
          ____________________

by default async function will always return a promise!

normal requests do redirect or create? a new html page

async does it behind the scenes just in the backend! (for deleting an item for example)

works with JSON data (mostly)



SYNTAX:

let test = async (req, res) => {
const example = await ....;
};



"Top Level await"

could also be used outside of a function




          RESPONSES
          _________

res  means response  (Server)Backend (is now saving the data to a Database ) and after, is sending a response to the (Client)Frontend

          Its called a Request-Response Cycle
          
- In the Backend(files) we define what types of requests are allowed- and how we handle these requests

app.post(â€˜/ordersâ€˜, (req, res) => {                      link: youtube -> supersimpledev Video: backend web development
  const order = createOrder(req);
  database.save(order);
  res.send('Order confirmed.');
});

app.get(â€˜/ordersâ€˜, (req, res) => {
  const orders = database.getOrderHistory();
  res.json(orders);
});

app.delete('/orders', (req, res) => {
  database.cancelOrder(req);
  res.json('Order canceled.');
});

          
export    allows that a MODUL can be used in another file
exports
import    allows a file to consume a MODUL (which is exported)




          ROUTING
          _______



BAS USAGE       FAB

app.route()                                 https://expressjs.com/de/guide/routing.html#app-route

- we can use this method instead of 3 different routes


app.route('/book')
  .get(function(req, res) {
    res.send('Get a random book');
  })
  .post(function(req, res) {
    res.send('Add a book');
  })
  .put(function(req, res) {
    res.send('Update the book');
  });








-> HOW TO CONNECT HTML FILE with another Files (URLs)     lecture 234 // or 70 max

-> for routing we use express (in real world)


__________________________________________________
-> from sratch we use: const url = require("url");


const fs = require("fs");
const http = require("http");
const url = require("url");

const server = http.createServer((req, res) => {
  const pathName = req.url;

  if (pathName === "/" || pathName === "/1234") {
    res.end("This is the 1234 URL");
  } else if (pathName === "/differentURL") {
    res.end("This is a different URL");
  } else {
    res.writeHead("404"); // OPTIONAL to write the statuscode
    res.end("Page not found");
  }
});

server.listen(8000, () => {
  console.log("Server is listening on request on port 8000");
});
__________________________________________________


NOTE:
./ is the root folder of the current directory -> NOT optimal
__dirname -> optimal


app.js:

app.get('/', (req, res) => {
  res.sendFile(__dirname + '/index.html');
});



with ROUTES FOLDER
__________________

app.js:                   

-> we use PATH now when we are routing

const path = require('path');   ****** WITH THIS LINE


app.get('/', function(req, res) {
  res.sendFile('index.html');                                                 RELATIVE PATH   (This will only look in the current directory/folder)


app.get('/', function(req, res) {
  res.sendFile(path.join(__dirname, './', 'views', 'index.html'))});          This will give us the file whereever it is / __dirname means directory name        
  
  
  
route file: (nested inside the Routes folder)

const express = require('express'); ??? line neccessary?

const router = express.Router();            // for  the export to app.js file

router.use('/', (req, res, next) => {   // we have to use the name router in the front
    res.sendFile(path.join(__dirname, '../', 'views', 'page.html')); // **** WITH THIS LINE AS WELL // !!! sendFile !!! to connect with the html file
});

module.exports = router;                    // for  the export to app.js file


________________________

     Routing ejs files !?!?
     
     Static Side:
     
app.get('/', function(req, res) {
    res.render('home.ejs');                 // also worked without .ejs 
});


    With Dynamic Content:
    
app.get('/', function(req, res) {
    res.render('home.ejs', {startingContent: homeStartingContent}); 
});                               â†‘                   â†‘ 
                                 Key                Value
                         (name in ejs file)    (name in app.js file)
                         
_______________________

How to use more than one export from one file:    // Lektion 272


module.exports.getDate = getDate;

function getDate() {
}

......

module.exports.getDay = getDay;

function getDay() {
}

and than requirering the FILE in the app.js file ->

const date = require(__dirname + '/date.js');     




          STATUSCODES
          ___________

200 Success
201 Created -> when we have overwritten a json file for example
204 Deleted -> means: No Content
4** Client Error
5** Server Error
500 Internal Server Error



NPM (Package Manager)
3rd Party Packages sind "Dependencies" -> findet man unter  npm Repository
Zum installieren ->
Befehl: npm install name


// 404 
appExpress.use((req, res, next) => {
    res.status(404).sendFile(path.join(__dirname, 'views', '404.html'));
});




          TYPES OF ERRORS
          _______________

Syntax Errors = Typos (something is wrong with our code) 
Runtime Erros / hat wohl noch anderen Namen
Logical Errors -> (werden nicht angezeigt) -> findet man ggf. mit dem "debugger"

CORS Error (Lektion 366) -> solving only on our?? server




          SERVER SIDE RENDERING with TEMPLATING ENGINES (EJS) 
          -> FOR  DYNAMIC  OR REALTIME CONTENT/FEATURES IN THE FRONTEND 
          _____________________________________________________________

or View Engine. ??Thats why we need, in this case,?? 



TEMPLATING ENGINES:

PUG
HANDLEBARS
EJS
- when using EJS -> we need a Views folder!
- IMPORTANT ejs does not support layouts -> but theres is a solution for:

                   1. npm i ejs
                    
                   2. app.js file:    
                   
                   app.set('view engine', 'ejs');     // (.set => we get no err)
                   app.use('view engine', 'ejs');     

                    3. create a views folder (neccessary for using ejs files)

                    4. create a template index.ejs file


Syntax: 

          <%= %>    to import / (output) a VALUES  <%= value %> 

          <% %>     with this we can use javascript in a html file. EVERY line which is NOT html and should be dynamic, must be embedded with <% .... %> 
        
          <%- %>


inline if statement in javascript  with ?
inline else statement in javascript with :

example:  <a class="<%= path === 'admin/add-product' ? 'active' : '' %>" href="/">Shop</a>


how to use? -> with  render  method
res.render....



header and footer for all sites:

making seperate header and footer .ejs files

add these lines

<%- include('header.ejs') -%>
<%- include('footer.ejs') -%>



DYNAMIC CONTENT
_______________

<% posts.forEach(function(post) { %>        <!-- this is doing the same like a for loop -->
<%     console.log(post.content); %>

<!-- MAGIC LINE to include it into the website  LEKTION 304 -->
<p> <%= post.content %> </p>            
<% }); %>




          MVC (ARCHITECTURE) / DESIGN PATTERN  kind of Important
          ___________________________________

- Model View Controller -


               Routes
                 |
Models Views Controllers

= Seperation of Concerns





ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED 
**************************************************************************************************************************************
ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED ADVANCED




          SENDING E-MAIL <how to>
          _______________________

we have to use a third party service (Mail Service)
- like https://api.sender.net/

- npm install --save nodemailer
- npm install --save nodemailer nodemailer-sendgrid-transport




          HOW TO SETUP COOKIES
          ____________________

  res.setHeader('Set-Cookie', 'loggedIn=true');
  
  

  
           SESSIONS       
          _________

 npm install --save express-session

- is only for one user
- Cookies are on the client side
- Sessions are on the SERVER SIDE

How to use sessions with mongodb        npm install --save connect-mongodb-session




          PASSWORD ENCRYPTION/HASHING
          ___________________________

npm i bcryt

NOTE:
best place to implement password encryption is the model (User Model for example)

const bcrypt = require('bcrypt');
const saltRounds = 12;              // 12 rounds is enough these days


To hash a password:

bcrypt.hash(myPlaintextPassword, saltRounds, function(err, hash) {
    // Store hash in your password DB.
});


To check a password:

// Load hash from your password DB.
bcrypt.compare(myPlaintextPassword, hash, function(err, result) {
    // result == true
});




          CSRF PROTECTION
          _______________

- npm install --save csurf

- -> now we can use a CSRF Token (a string value)

- npm install --save connect-flash
The flash is a special area of the session used for storing messages. Messages are written to the flash and cleared after being displayed to the user. 




          WEBSOCKETS (API)    
          ________________

FAB -> https://socket.io/docs/v4/client-installation/
perfect guide -> https://socket.io/get-started/chat 


- we PUSH data from the server to -> the client
- socket.IO is recommended

npm install --save socket.io
npm install --save socket.io-client


// working code
const express = require('express');
const app = express();
const server = require('http').createServer(app);
const io = require('socket.io')(server, { cors: { origin: "*" }});

server.listen(3000);
console.log('server is running');

app.get('/', (req, res) => {
    res.sendFile(__dirname + '/index.html');
});




          LODASH          
          ______

https://lodash.com


npm i --save lodash

const _ = require('lodash');




          OAUTH
          _____

https://www.passportjs.org/packages/passport-google-oauth20/

npm i passport-google-oauth20

npm i mongoose-findorcreate

npm i passport




          dotenv  .ENV
          _____________

npm i dotenv

- for environment variables
- for NOT showing sensitive/privat data like API or encryption keys or mongoDB login data etc.


app.js:

require('dotenv').config()

console.log(process.env) // remove this after you've confirmed everything is working


CONFIGURATION
_____________

.env file has to be in the root folder!
naming has to be .env !


SYNTAX RULES: we have key value pairs (no "" needed)

NAME=VALUE
SECRET=ThisIsOurSecret
API_KEY=jdiuwjwnduidnwoqidnqidno
